# 数据库引擎

## `InnoDB`

> `MySQL` 默认的事务型引擎，也是最重要和使用最广泛的存储引擎。它被设计成为大量的短期事务，短期事务大部分情况下是正常提交的，很少被回滚。`InnoDB` 的性能与自动崩溃恢复的特性，使得它在非事务存储需求中也很流行。除非有非常特别的原因需要使用其他的存储引擎，否则应该优先考虑 `InnoDB` 引擎。

`InnoDB` 采用 `MVCC` 来支持高并发，并实现了四个标准的隔离级别。默认级别是`REPEATABLE READ`（可重复读），并且通过间隙锁策略防止幻读的出现。间隙锁使得 `InnoDB` 不仅仅锁定查询涉及的行，还会对索引中的间隙进行锁定，以防止幻影行的插入。

[MySQL的锁机制 - 记录锁、间隙锁、临键锁](https://zhuanlan.zhihu.com/p/48269420)

`InnoDB` 基于聚簇索引建立。聚簇索引对主键索引有很高性能，不过它的二级索引中必须包含主键列，索引如果主键列很大，其他所有索引都会很大。所以若表上的索引比较多的话，主键应当尽可能的小。

`InnoDB` 内部优化：从磁盘读取数据采用的可预测性预读，能够自动在内存中创建 `hash` 索引以加速读操作的自适应哈希索引，以及能够快速插入操作的缓冲区等。

## `MySIAM`

> 是 5.1 及之前版本的默认引擎。

### 特性

- 全文索引、压缩、空间函数等，但不支持事务和行级锁。而且崩溃后无法安恢复。
- 对于只读数据或者比较小可以忍受修复操作，则可使用。
- 将表存储在两个文件中：数据文件和索引文件，分别以`.MYD`和`.MYI`为扩展名。表可包含动态或者静态（长度固定）行，可存储的行记录受限于可用的磁盘空间或者系统中单个文件的最大尺寸。
- 加锁与并发。整张表加锁，读数据加共享锁，写数据排它锁。也可并发插入。
- 修复。

可以将数据表压缩，这样减少空间，而且读时不用全解压，只需解压对应行的数据。

## 如何转换表的引擎？

`mysql> ALTER TABLE mytable ENGINE = InnoDB`
执行很长时间，从一张表复制到新表，原表会加锁。
但，`InnodB--->MyISAM--->InnoDB` 外键将会丢失。

## `MySQL` 内建的其他存储引擎

- `Archive`
- `Blackhole`
- `CSV`
- `Federated`
- `Memory`
- `Merge`
- `NDB`

[Mysql 中 MyISAM 和 InnoDB 的区别有哪些？](https://www.zhihu.com/question/20596402)

